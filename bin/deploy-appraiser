#!/usr/bin/env bash
set -ex

BIN_DIR=${BIN_DIR:-$(cd "${0%/*}"&&pwd)}
ADDRESS_DIR=${ADDRESS_DIR:-$PWD/addresses}
mkdir -p $ADDRESS_DIR 

export ETH_GAS=${ETH_GAS:-"1100000000"}
export ETH_FROM=${ETH_FROM:-$(seth rpc eth_coinbase)}
export SOLC_FLAGS="--optimize"

test -z "$SKIP_BUILD" && dapp build

# Set god address to 0 if not defined
test -z "$GOD_ADDR" && GOD_ADDR="0x00000000000000000000"

APPRAISER=$(dapp create Appraiser)

source $BIN_DIR/lib/load-addresses
touch "$ADDRESS_DIR/addresses-$(seth chain).json"
addAddresses "$ADDRESS_DIR/addresses-$(seth chain).json" <<EOF
{
    "APPRAISER": "$APPRAISER"
}
EOF

